<!doctype html>
<html>
<!--
  Results Page | Cannlytics Website
  Copyright (c) 2022-2024 Cannlytics

  Authors: Keegan Skeate <https://github.com/keeganskeate>
  Created: 9/29/2022
  Updated: 3/24/2024
  License: MIT License <https://github.com/cannlytics/cannlytics/blob/main/LICENSE>
-->
{% extends "website/components/layout/dashboard.html" %}
{% load static icon %}
{% block title %}
  {% if section and section not in 'logs,files,certificates' %}
    {{ section }} | Cannlytics
  {% else %}
    Results | Cannlytics
  {% endif %}
{% endblock %}
{% block dashboard_css %}

  <!-- AG Grid -->
  <script src="https://unpkg.com/ag-grid-community/dist/ag-grid-community.min.noStyle.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/ag-grid-community/styles/ag-grid.css"/>
  <link rel="stylesheet" href="https://unpkg.com/ag-grid-community/styles/ag-theme-alpine.css"/>
  <script src="https://unpkg.com/ag-grid-community/dist/ag-grid-community.min.js"></script>

  <!-- Bootstrap Datepicker -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css" integrity="sha512-mSYUmp1HYZDFaVKK//63EcZq4iFWFjxSL+Z3T/aCt4IO9Cejm03q3NKKYN6pFQzY0SBOr8h+eCIAZHPXcpZaNw==" crossorigin="anonymous" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js" integrity="sha512-T/tUfKSV1bihCnd+MxKD0Hm1uBBroVYBOYSk1knyvQ9VyZJpc/ALb4P0r6ubwVPSGB2GvjeoMAJJImBG12TiaQ==" crossorigin="anonymous"></script>

{% endblock %}
{% block dashboard %}
{% if section and section not in 'logs,files,certificates' %}

  <!-- Result page -->
  <main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-md-4 pb-5 mx-auto">
    {% include "website/pages/results/result.html" with
      id=section
    %}
    {% block unit %}{% endblock unit %}
  </main>

{% else %}

<!-- Optional:  -->
{% comment %} {% include "website/components/heros/hero_banner.html" with
  title=''
  description="Get cannabis lab test results while they're hot!"
  image_url=''
  image_size="200px"
  only
%} {% endcomment %}

{% comment %} <!-- Breadcrumbs -->
<section class="container mb-3">
  <div class="d-flex mt-4">
    <nav
      style="--bs-breadcrumb-divider: '>';"
      aria-label="breadcrumb"
    >
      <ol class="breadcrumb bg-transparent p-0 mb-0">
        <li class="breadcrumb-item fs-6 lh-sm">
          <a
            class="text-dark serif action"
            href="{% url 'page' page='data' %}"
          >
            Data
          </a>
        </li>
        <li class="breadcrumb-item fs-6 lh-sm">
          <a
            class="text-dark serif action"
            href="{% url 'section' page='data' section='results' %}"
          >
            Lab Results
          </a>
        </li>
      </ol>
      <div>
    </div>
    </nav>
  </div>
</section> {% endcomment %}

<!-- Results -->
<section class="container markdown">

  <h1>Lab Results</h1>

  <!-- Search Bar -->
  {% include "website/components/dashboard/search.html" with
    placeholder_text="Search results..."
  %}

  <!-- Filters -->
  <div class="selections-container align-items-center">

    <!-- Date selection -->
    {% include "website/components/dashboard/date_selection.html" %}

    <!-- State selection buttons -->
    {% include "website/components/dashboard/state_selection.html" %}

    <!-- Filter by product type -->
    {% include "website/components/dashboard/product_type_selection.html" %}
    
  </div>

  <!-- TODO: Sort by compound -->

  <!-- TODO: Filter by producer -->

  <!-- List/Grid View -->
  <div class="btn-group btn-group-sm" role="group" aria-label="View selection">
    <button type="button" class="btn btn-primary" id="gridViewButton" onclick="cannlytics.resultsJS.renderGridView()">
      <i class="bi bi-grid"></i> Grid
    </button>
    <button type="button" class="btn btn-outline-primary" id="listViewButton" onclick="cannlytics.resultsJS.renderListView()">
      <i class="bi bi-list"></i> List
    </button>
  </div>

  <!-- Results List/Grid -->
  <div
    id="resultsContainer"
    class="mt-3 row ag-theme-quartz ag-theme-quartz-dark"
    data-masonry='{"percentPosition": true }'
  ></div>

</section>
{% endif %}
{% endblock %}
{% block dashboard_js %}
{% if section and section not in 'logs,files,certificates' %}
  <script>

    // Initialize result. 
    cannlytics.resultsJS.initializeResult();

  </script>
{% else %}
  <script>

    // Render the date picker for both start and end date inputs
    $('.datepicker').datepicker({
      format: 'mm/dd/yyyy',
      autoclose: true,
      todayHighlight: true
    });
    const startDateInput = $('#dateTestedStart');
    const endDateInput = $('#dateTestedEnd');
    const currentDate = new Date();
    const firstDayOfMonth = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
    $('#dateTestedStart').datepicker('setDate', firstDayOfMonth);
    $('#dateTestedEnd').datepicker('setDate', currentDate);

    // JavaScript function to handle state selection
    function updateStateSelection(selectedState) {
      document.querySelectorAll('.btn-group .btn').forEach(function(btn) {
        btn.classList.remove('btn-primary');
        btn.classList.add('btn-outline-primary');
      });
      document.getElementById('btn' + selectedState).classList.remove('btn-outline-primary');
      document.getElementById('btn' + selectedState).classList.add('btn-primary');
      cannlytics.resultsJS.initializeResults();
    }

    // Initialize results. 
    cannlytics.resultsJS.initializeResults();

  </script>
{% endif %}
{% endblock %}
</html>
