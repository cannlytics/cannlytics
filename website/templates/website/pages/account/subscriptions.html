<!doctype html>
<html>
<!--
  Subscription Management Page | Cannlytics Website
  Copyright (c) 2021-2022 Cannlytics

  Authors: Keegan Skeate <https://github.com/keeganskeate>
  Created: 11/16/2021
  Updated: 6/21/2023
  License: MIT License <https://github.com/cannlytics/cannlytics-website/blob/main/LICENSE>
-->
{% extends "website/index.html" %}
{% load static icon %}
{% block title %}Subscription | Cannlytics{% endblock %}
{% block page_css %}

  <!-- Minor Style Adjustments -->
  <style>
    .tooltip-inner {
      text-align: left;
    }
    .bg-purple {
      background-color: #7B4EA8 !important;
    }
    .bg-orange {
      background-color: #FF7F00 !important;
    }
    .bg-green {
      background-color: #16c995 !important;
    }
    .btn-purple {
      background-color: #7B4EA8 !important;
      color: white;
    }
    .btn-orange {
      background-color: #FF7F00 !important;
      color: white;
    }
    .btn-green {
      background-color: #16c995 !important;
      color: white;
    }
  </style>

  <!-- PayPal Subscriptions JavaScript -->
  <script src="https://www.paypal.com/sdk/js?client-id={{ paypal.client_id }}&vault=true&intent=subscription" data-sdk-integration-source="button-factory"></script>

{% endblock page_css %}
{% block material %}

  <!-- Header -->
  {% include "website/components/heros/hero_banner.html" with
    title="Manage your Cannlytics Subscription"
    description="Explore subscription plans and find the right plan for you."
    background_image="https://firebasestorage.googleapis.com/v0/b/cannlytics.appspot.com/o/assets%2Fimages%2Fai%2Fcannbot-ai.png?alt=media&token=3f2b4dcd-d661-404e-b417-c38768f1cb44"
    background_position="top left"
    only
  %}

  <!-- Sign In Prompt -->
  <section class="indicates-auth container mb-2 mt-5 d-flex justify-content-center">
    <div class="markdown py-5" style="max-width:560px;">
      <svg class="pe-3 pt-3" style="float:left;width:125px;height:125px;">
        <use href="{% static "website/images/emojies/newspaper.svg" %}#newspaper-emoji"></use>
      </svg>
      <h1 class="pt-4 text-dark">Cannlytics Subscriptions</h1>
      <p class="mt-2">
        You will need to create an account or to sign in
        to take advantage of Cannlytics subscriptions.
      </p>
      <div class="d-flex justify-content-center mt-3">
        <a
          class="btn bg-gradient-green text-white serif mx-2"
          data-bs-target="#sign-in-dialog"
          data-bs-toggle="modal"
        >
          Sign in
        </a>
        <a
          class="btn bg-gradient-orange text-white serif mx-2"
          href="{% url 'section' page='account' section='sign-up' %}"
        >
          Sign Up
        </a>
      </div>
    </div>
  </section>

  <!-- Subscription Management -->
  <section class="requires-auth container mb-2">

    <!-- Breadcrumbs -->
    <div class="d-flex mt-4 markdown">
      <nav
        style="--bs-breadcrumb-divider: '>';"
        aria-label="breadcrumb"
      >
        <ol class="breadcrumb bg-transparent p-0 mb-0">
          <li class="breadcrumb-item fs-6 lh-sm">
            <a
              class="text-dark serif action"
              href="{% url 'page' page='account' %}"
            >
              Account
            </a>
          </li>
          <li class="breadcrumb-item active fs-6 lh-sm text-dark serif" aria-current="page">
            Subscriptions
          </li>
        </ol>
        <div>
      </div>
      </nav>
    </div>

    <!-- FIXME: 
     - If no subscription, then show Upgrade on all.
     - If subscription, then show Cancel on current subscription and Change on others.
    -->
    <div class="markdown mt-3">
      <img src="https://firebasestorage.googleapis.com/v0/b/cannlytics.appspot.com/o/public%2Fimages%2Flogos%2Fcannlytics_calyx_ai.png?alt=media&token=012e8364-8ee2-4d91-9ec2-ab5f55b23059"
        style="float:left;width:125px;height:125px;"
        class="pt-3 pe-3"
      />
      <h1 class="pt-4 text-dark">Cannlytics AI Subscription</h1>
      <p class="mt-2" style="max-width:560px;">
        You can get access to bleeding-edge AI tools to give yourself
        a competitive edge, including:
        <a href="https://data.cannlytics.com/results">a COA parser</a>,
        <a href="https://data.cannlytics.com/sales">a receipt parser</a>,
        <a href="https://data.cannlytics.com/licenses">licenses data archive</a>, and
        <a href="https://cannlytics.com/api">API access</a>.
      </p>
      
      <!-- Tiers -->
      <div class="row row-cols-1 row-cols-md-3 mb-3 mt-4 text-center">
        {% for item in subscription_plans %}
          <div class="col-8 col-md-6 col-lg-4">
            <div class="card mb-4 shadow-sm">
              <div class="card-header bg-gradient-{{ item.color }}">
                <h4 class="fw-bold text-white my-0">
                  {{ item.name }}
                </h4>
              </div>
              <div class="card-body bg-transparent d-flex flex-column justify-content-between align-items-center">
                <h1 class="text-dark card-title pricing-card-title">
                  {{ item.price }}
                </h1>
                <ul class="text-dark list-unstyled mt-3 mb-4 text-start w-75">
                  {% for attribute in item.attributes %}
                      <li class="fs-6 mb-1">
                        <svg class="" style="width:24px;height:24px;">
                          <use href="{% static "website/images/emojies/check.svg" %}#check-emoji"></use>
                        </svg>
                        <small class="serif text-dark">
                          {{ attribute }}
                        </small>
                      </li>
                  {% endfor %}
                </ul>
                <div class="d-grid gap-2">
                  <button
                    id="subscribe-{{ item.plan_name }}-button"
                    class="btn bg-gradient-{{ item.color }} text-white serif"
                  >
                    {{ item.action|safe }}
                  </button>
                  <button
                    id="unsubscribe-{{ item.plan_name }}-button"
                    class="btn bg-gradient-{{ item.color }} btn-lg d-none"
                  >
                    Unsubscribe
                  </button>
                </div>
                <div id="paypal-{{ item.plan_name }}"></div>
              </div>
            </div>
          </div>
        {% endfor %}
      </div><!-- End of tiers -->

    </div><!-- End of support options -->

    <!-- Tokens-->
    {% include "website/pages/account/tokens.html" with
      user=user
      only
    %}

    <!-- Future work: Usage -->

    <!-- Subscribe / unsubscribe from newsletter -->
    <div class="markdown mb-5 mt-3" style="max-width:560px;">
      <svg class="pe-1 pt-3" style="float:left;width:125px;height:125px;">
        <use href="{% static "website/images/emojies/newspaper.svg" %}#newspaper-emoji"></use>
      </svg>
      <h1 class="pt-4 text-dark">Free Newsletters</h1>
      <p class="mt-2">
        You can receive periodic newsletters and updates from Cannlytics if you
        believe that you will benefit from our free material, including novel
        datasets and statistics.
      </p>
      <div class="card col-8 my-3 p-3 border rounded text-dark">
        <h3 class="mb-3 mt-0">Newsletters</h3>
        <div class="d-flex justify-content-between mb-3">
          <div class="form-check pe-4">
            <input
              id="free-newsletter-checkbox"
              class="form-check-input"
              type="checkbox"
            >
            <label
              class="app-action background-hover form-check-label"
              for="free-newsletter-checkbox"
            >
              Subscribe to Free Monthly Newsletter
            </label>
          </div>
          <div class="text-secondary text-nowrap">Free</div>
        </div>
      </div>
    </div>

    <!-- List sponsorship packages -->
    {% comment %} {% include "website/pages/subscriptions/sponsorships.html" %} {% endcomment %}

  </section>

{% endblock material %}

<!-- JavaScript -->
{% block page_js %}

<!-- Make user's subscriptions available to JavaScript -->
{% comment %} {{ user.newsletter|json_script:"user_newsletter" }}
{{ user.premium|json_script:"user_premium" }}
{{ user.subscriptions|json_script:"user_subscriptions" }}
{{ user.support|json_script:"user_support" }} {% endcomment %}

<script>

  // FIXME:
  // Initialize the interface with the user's current subscriptions.
  cannlytics.payments.initializeSubscriptions();
  // cannlytics.payments.initializeSupport();

  // Initialize the newsletter
  cannlytics.payments.initializeFreeNewsletter();
  $('#free-newsletter-checkbox').change(function() {
    cannlytics.payments.subscribeToFreeNewsletter();
  })

  // TODO: Automatically unsubscribe user from newsletter if they navigate with
  // special query parameter that is a salted hash of their email.

  // Enable tooltips.
  cannlytics.ui.enableTooltips();

</script>

{% endblock page_js %}
